#define BLYNK_TEMPLATE_ID ""
#define BLYNK_TEMPLATE_NAME ""
#define BLYNK_AUTH_TOKEN ""

#include <WiFi.h>
#include <BlynkSimpleEsp32.h>
#include <IRremoteESP8266.h>
#include <IRsend.h>

char ssid[] = "";
char pass[] = "";

const uint16_t kIrLed = 4;  // GPIO pin connected to transistor base circuit
IRsend irsend(kIrLed);

// Raw data arrays
uint16_t rawData_ON[] = {3074, 3022,  3078, 4420,  608, 1584,  606, 502,  608, 1584,  606, 502,  604, 482,  604, 1606,  604, 1586,  608, 480,  604, 1608,  602, 484,  610, 494,  606, 502,  602, 484,  608, 496,  604, 1588,  602, 504,  602, 486,  608, 494,  604, 504,  602, 486,  606, 496,  604, 502,  598, 486,  600, 504,  574, 512,  608, 496,  602, 506,  574, 512,  604, 498,  602, 506,  572, 512,  576, 532,  574, 512,  604, 1606,  572, 516,  604, 500,  574, 532,  570, 518,  602, 502,  568, 518,  602, 502,  572, 536,  568, 1622,  574, 536,  564, 520,  568, 534,  574, 516,  600, 502,  572, 536,  566, 522,  564, 538,  570, 536,  564, 522,  564, 538,  570, 516,  562, 540,  570, 538,  562, 524,  564, 1648,  564, 524,  564, 540,  568, 542,  560, 520,  566, 542,  560, 524,  562, 542,  566, 542,  584, 502,  560, 542,  566, 540,  582, 500,  564, 542,  584, 502,  558, 544,  566, 542,  584, 502,  586, 518,  588, 520,  582, 500,  588, 520,  582, 502,  586, 520,  590, 518,  584, 502,  584, 520,  590, 520,  582, 500,  588, 520,  582, 502,  584, 520,  590, 520,  580, 506,  584, 520,  588, 520,  578, 504,  588, 520,  580, 506,  586, 520,  586, 520,  578, 508,  584, 520,  588, 522,  576, 504,  590, 518,  576, 1616,  586, 522,  574, 1616,  586, 504,  590, 1618,  588, 502,  566, 536,  588, 520,  586};
uint16_t rawData_OFF[] = {3074, 3022,  3074, 4424,  586, 1604,  610, 498,  584, 1604,  612, 498,  584, 500,  604, 1608,  586, 1604,  586, 498,  606, 1610,  584, 500,  604, 500,  610, 478,  604, 500,  606, 500,  608, 474,  606, 500,  608, 480,  602, 502,  606, 500,  608, 480,  586, 520,  604, 500,  608, 476,  606, 500,  606, 482,  600, 502,  606, 498,  606, 484,  606, 494,  606, 500,  604, 480,  602, 502,  604, 484,  608, 496,  602, 502,  604, 484,  608, 494,  606, 502,  600, 484,  602, 502,  602, 488,  604, 496,  602, 1594,  606, 496,  602, 504,  576, 512,  606, 496,  576, 514,  604, 498,  600, 508,  572, 514,  606, 496,  578, 530,  572, 516,  604, 498,  570, 516,  604, 498,  576, 530,  570, 1620,  576, 532,  570, 518,  602, 500,  574, 514,  602, 502,  572, 534,  566, 520,  602, 502,  570, 534,  566, 520,  600, 504,  572, 516,  600, 502,  570, 538,  564, 522,  572, 532,  568, 538,  566, 522,  562, 540,  568, 520,  570, 534,  568, 540,  560, 526,  560, 542,  566, 542,  584, 504,  560, 542,  566, 520,  562, 542,  566, 542,  586, 502,  584, 518,  564, 544,  582, 502,  586, 518,  590, 496,  584, 520,  588, 520,  582, 502,  584, 520,  588, 520,  582, 502,  584, 1628,  584, 500,  588, 1600,  588, 502,  588, 1620,  590, 1606,  586, 520,  586, 1606,  586, 520,  584, 1606,  586, 1606,  586};

void setup() {
  Serial.begin(115200);
  Blynk.begin(BLYNK_AUTH_TOKEN, ssid, pass);
  irsend.begin();
  Serial.println("IR Controller Ready");
}

BLYNK_WRITE(V0) {
  int state = param.asInt();  // 1 = ON, 0 = OFF
  if (state == 1) {
    Serial.println("Sending AC ON signal");
    irsend.sendRaw(rawData_ON, sizeof(rawData_ON) / sizeof(uint16_t), 38);
  } else {
    Serial.println("Sending AC OFF signal");
    irsend.sendRaw(rawData_OFF, sizeof(rawData_OFF) / sizeof(uint16_t), 38);
  }
}

void loop() {
  Blynk.run();

  // Optional serial control
  if (Serial.available()) {
    char cmd = Serial.read();
    switch (cmd) {
      case 'N':
        irsend.sendRaw(rawData_ON, sizeof(rawData_ON) / sizeof(uint16_t), 38);
        break;
      case 'O':
        irsend.sendRaw(rawData_OFF, sizeof(rawData_OFF) / sizeof(uint16_t), 38);
        break;
      default:
        Serial.println("Unknown command. Use N/O.");
    }
    while (Serial.available()) Serial.read();
  }
}
